# jady.call Standard Interface

이 문서는 `jady.call`의 표준 인터페이스를 정의합니다. 모든 언어의 구현체는 이 문서에 정의된 이름과 구조를 엄격히 준수해야 합니다.

## 0. 기본 원칙 (General Principles)

- **Asynchronous**: 모든 구현체는 기본적으로 **비동기(Async)** 동작을 지향해야 합니다. (Return Promise, Future, Coroutine, etc.)
- **Semantic Consistency**: **동일한 설정(Config)은 어떤 언어/플랫폼에서 실행되든 동일한 의미(Semantics)와 동일한 HTTP 요청 결과를 보장해야 합니다.**
    - 이를 위해, 플랫폼에 따라 동작이 달라지거나 구현이 불가능한 기능은 **`platform`** 객체 아래로 분리하여 명시적으로 사용하도록 합니다.
- **Stateless**: `jady.call`은 상태를 가지지 않는 순수 함수(Pure Function) 혹은 정적 메서드(Static Method)처럼 동작해야 합니다.
    - **No Cookie Jar**: 라이브러리는 내부적으로 쿠키 저장소(Cookie Jar)를 유지하지 않습니다. 즉, 이전 요청의 `Set-Cookie`가 다음 요청에 자동으로 포함되지 않습니다.
        - **Browser Exception**: 단, 브라우저 환경에서는 브라우저(User Agent)가 자체적으로 관리하는 쿠키 저장소가 동작하며, 이는 라이브러리가 제어할 수 없는 영역입니다.
    - **Connection Pooling**: 단, 성능 최적화를 위해 내부적으로 TCP/TLS 연결 풀(Connection Pool)은 전역적으로 관리되거나 재사용될 수 있습니다. 이는 사용자 레벨의 세션 상태(Session State)와는 구별됩니다.
- **Immutability**: 라이브러리는 사용자가 전달한 `config` 객체를 **변경하지 않아야 합니다(Immutable)**. 내부 처리를 위해 필요한 경우 복사본을 사용하여, 원본 객체의 재사용성을 보장해야 합니다.
- **Thread Safety**: `jady.call` 함수는 **스레드 안전(Thread-safe)**해야 합니다. 멀티스레드 환경에서 동시에 호출되더라도 내부 상태 공유로 인한 부작용이 없어야 합니다.
- **Fail Fast**: 잘못된 설정(Invalid Config)이나 호환되지 않는 옵션 조합이 감지되면, 요청을 보내기 전에 즉시 **예외(Exception)**를 발생시켜야 합니다. (Silent Failure 방지)
- **Predictable Behavior**: 동일한 `config` 객체는 항상 동일한 HTTP 요청(메서드, URL, 헤더, 본문)을 생성해야 합니다. 응답 객체에 포함되는 `duration`이나 자동 생성된 `requestId` 등 동적인 값은 예외입니다. 이는 테스트 용이성과 예측 가능성을 보장합니다.
- **Consistent Error Structure**: 라이브러리에서 발생하는 모든 예외는 **3. 에러 처리** 섹션에 정의된 표준 구조(코드, 메시지 등)를 따라야 합니다. 이를 통해 사용자는 언어에 상관없이 일관된 방식으로 에러를 처리할 수 있습니다.
- **Minimal Dependency**: 라이브러리는 외부 의존성을 최소화하여 가볍고 이식성이 높아야 합니다. 플랫폼 내장 기능(Native API)을 최대한 활용하는 것을 권장합니다.
- **Explicit Over Implicit**: 암시적인 "마법" 동작보다는 명시적인 설정을 우선합니다. 사용자가 설정하지 않은 값에 대해 라이브러리가 임의로 추측하여 동작을 변경하지 않아야 하며, 모든 기본값(Default)은 문서에 명시된 대로만 적용되어야 합니다.
- **RFC Compliance**: 동작이 모호하거나 문서에 정의되지 않은 엣지 케이스의 경우, 최신 HTTP RFC 표준(RFC 723x, RFC 911x 등)을 따르는 것을 원칙으로 합니다.
- **Secure by Default**: 편의성보다 보안을 우선합니다. 모든 보안 관련 설정(SSL 검증, 살균 등)의 기본값은 가장 안전한 상태여야 합니다.
- **UTF-8 by Default**: 문자열 처리(URL, JSON, Body, Auth 등)의 기본 인코딩은 **UTF-8**입니다. 단, HTTP 헤더와 같이 표준 스펙이 특정 인코딩(ASCII/ISO-8859-1)을 강제하는 경우는 예외입니다.
- **Caller Ownership**: 리소스(Stream, File Handle 등)의 수명 주기는 **호출자(Caller)**가 관리합니다.
    - **Input**: 사용자가 전달한 스트림이나 파일 핸들은 라이브러리가 읽기만 할 뿐, 전송 후 자동으로 닫지 않습니다.
    - **Output**: `responseType: 'stream'` 등으로 반환된 리소스는 사용자가 명시적으로 닫아야(Close) 합니다.
- **Type Safety**: 정적 타입 언어(TypeScript, Java, Go 등) 구현체는 컴파일 타임에 오류를 잡을 수 있도록 정확한 타입 정의와 제네릭(Generics)을 제공해야 합니다.

## 1. 필수로 포함되어야 할 파라미터 (The Input)

어떤 언어의 `jady.call()`이든 다음 인자들은 동일한 이름으로 존재해야 합니다.

- **baseUrl**: (Optional) 기본 URL (String).
    - `url`이 상대 경로일 경우, `baseUrl`과 결합됩니다.
    - **Slash Handling**: `baseUrl`이 `/`로 끝나고 `url`이 `/`로 시작하는 경우, 슬래시 하나가 제거되어 결합됩니다. (예: `host/` + `/path` -> `host/path`)
    - 반대로 두 값 사이에 슬래시가 없는 경우, 자동으로 `/`를 삽입하여 결합합니다. (예: `host` + `path` -> `host/path`)
    - `url`이 절대 경로(`http://...`)일 경우, `baseUrl`은 무시됩니다.
- **url**: 대상 주소 (String). (Path Parameter가 포함된 경우 `{key}` 또는 `:key` 형식 사용 권장)
- **path**: (Optional) URL Path Parameter 치환 객체 (Object/Dict).
    - `baseUrl`과 `url`이 결합된 최종 URL에서 `{key}` 또는 `:key` 패턴을 찾아 해당 값으로 치환합니다.
    - 값은 자동으로 **URL Encoding** 처리되어야 합니다. (경로 구분자 `/`를 포함한 모든 특수 문자가 인코딩되어야 합니다. 예: `id`가 `a/b`면 `a%2Fb`로 치환)
- **method**: HTTP 메서드 (String). (기본값: `GET`. 입력은 대소문자를 구분하지 않으나, 전송 시 **대문자**로 정규화됩니다.)
- **params**: (Optional) Query Parameter (Object/Dict). 표준 URL Encoding (`application/x-www-form-urlencoded`)으로 변환. (공백은 `+`로 인코딩)
    - **배열(Array/List)** 값은 키 반복(`key=v1&key=v2`) 형태로 직렬화합니다.
    - **중첩 객체(Nested Object)**는 지원하지 않으며, 전달 시 **예외(Exception)**를 발생시켜야 합니다.
    - `url`에 이미 쿼리 스트링이 존재하는 경우, `params`로 생성된 쿼리 스트링을 기존 쿼리 스트링 뒤에 **추가(Append)**합니다. (예: `url: '/?a=1'`, `params: {b:2}` -> `/?a=1&b=2`)
    - **Hash(#) 처리**: URL에 Hash(Fragment)가 포함된 경우, Query String은 반드시 **Hash(#) 앞**에 삽입되어야 합니다.
    - **String / Native**: 문자열이나 `URLSearchParams` 등 네이티브 객체가 전달되면, 별도 변환 없이 그대로 쿼리 스트링으로 사용합니다.
- **paramsArrayFormat**: (Optional) 배열 파라미터 직렬화 방식 (String, 기본값: `'repeat'`).
    - `'repeat'`: `key=v1&key=v2` (기본값)
    - `'brackets'`: `key[]=v1&key[]=v2`
    - `'comma'`: `key=v1,v2`
    - `'index'`: `key[0]=v1&key[1]=v2`
- **paramsSerializer**: (Optional) Query Parameter를 문자열로 변환하는 커스텀 함수. `(params) => string`
    - 이 값이 설정되면 `paramsArrayFormat`은 무시됩니다.
    - 반환값은 맨 앞의 `?`를 포함하지 않아야 합니다. (만약 포함된 경우, 라이브러리가 자동으로 제거합니다.)
    - 빈 문자열을 반환하는 경우, URL 끝에 `?`를 붙이지 않아야 합니다.
- **cookieMode**: (Optional) 쿠키 처리 방식을 정의하는 모드 (String, 기본값: `'none'`).
    - `'none'`: 쿠키를 자동으로 처리하지 않습니다. `headers.Cookie`를 통해 수동으로만 설정할 수 있습니다.
    - `'browser'`: 브라우저의 내장 쿠키 메커니즘을 사용합니다. `withCredentials` 옵션의 영향을 받습니다. (브라우저 환경 전용)
    - `'manual'`: `platform.cookies` 옵션에 명시된 객체를 직렬화하여 `Cookie` 헤더를 생성합니다. (서버 환경 전용)
- **data**: (Optional) Request Body (Object/Dict, String, Byte Array, Stream).
    - **GET, HEAD 메서드**: `data` 및 `files` 값이 존재하더라도 **무시(Ignored)**하고 전송하지 않습니다. (DELETE 등 그 외 메서드는 본문 전송 허용)
    - **Object/Dict**: 기본적으로 **JSON 직렬화** (`Content-Type: application/json` 자동 추가).
        - 예외: 헤더에 `application/x-www-form-urlencoded`가 명시된 경우, **Query String** 형태로 변환하여 전송합니다.
    - **String**: 그대로 전송 (`Content-Type` 미지정 시 `text/plain; charset=utf-8` 자동 추가).
    - **Byte Array/Buffer**: 그대로 전송 (`Content-Type` 미지정 시 `application/octet-stream` 자동 추가).
    - **Stream**: (Readable Stream, File-like Object) 메모리에 적재하지 않고 스트리밍 전송 (`Content-Type` 미지정 시 `application/octet-stream` 자동 추가).
    - **Form Data (`application/x-www-form-urlencoded`)**: `data`가 객체이고 헤더가 설정된 경우, `params`의 직렬화 규칙(`paramsArrayFormat`, `paramsSerializer`)을 따릅니다.
    - **Native Objects**: `FormData`, `URLSearchParams` (JS) 등 언어별 네이티브 객체가 전달되면, 별도 변환 없이 그대로 전송하며 적절한 `Content-Type`을 자동으로 설정합니다.
        - **Warning**: 이 기능은 편의를 위한 것이나, `multipart/form-data`의 `boundary` 생성 방식 등 플랫폼별 차이로 인해 HMAC 검증 실패 등 예측 불가능한 결과를 초래할 수 있으므로 표준 환경에서는 사용을 권장하지 않습니다.
        - 이 경우, 사용자가 `headers`에 명시한 `Content-Type`은 **무시**됩니다. (네이티브 객체의 타입이 우선함)
- **files**: (Optional) 파일 업로드 객체 (Multipart/form-data).
    - Key: Field Name, Value: File Object / Blob / Stream / Path(Server-side only) **또는 그 배열(Array)**.
    - **고급 설정**: Value를 `{ file: ..., filename?: string, contentType?: string }` 객체로 전달하여 파일명과 타입을 명시할 수 있습니다. (배열 내부 요소로도 사용 가능)
        - **Tip**: JSON 메타데이터 등 파일이 아닌 파트도 `Content-Type` 지정이 필요하다면 이 방식을 통해 `files`에 포함시킬 수 있습니다.
        - **Default Filename**: Stream이나 Buffer 등 파일명이 없는 객체가 전달되고 `filename` 옵션도 없는 경우, 라이브러리는 `'blob'` 또는 `'file'` 등 **임의의 기본 파일명**을 생성하여 `Content-Disposition` 헤더에 포함해야 합니다. (서버 거부 방지)
        - **Default Content-Type**: 명시되지 않은 경우 파일 확장자 등을 통해 추론하며, 추론 불가능 시 `application/octet-stream`을 사용합니다.
    - **Browser Environment**: 브라우저에서는 보안상 파일 경로(String)를 사용할 수 없으며, `File` 또는 `Blob` 객체를 직접 전달해야 합니다.
    - **Note**: 빈 `files` 객체(`{}`)는 내용이 없는 `multipart/form-data` 요청을 생성하며, 이는 일부 서버에서 올바르게 처리되지 않을 수 있습니다.
    - **Resource Management (Server)**: 전달된 Stream이나 파일 핸들은 요청 완료 후에도 라이브러리가 **자동으로 닫지 않습니다(No Auto-close)**. 리소스 관리는 호출자의 책임입니다.
    - 이 값이 존재하면 `Content-Type` 헤더는 **사용자 설정 값을 무시하고** 자동으로 `multipart/form-data; boundary=...`로 설정됩니다.
- **headers**: (Optional) HTTP 헤더 (Object/Dict).
    - **보안**: Header Value에 줄바꿈 문자(`\n`, `\r`)가 포함된 경우, **예외(Exception)**를 발생시켜야 합니다. (HTTP Response Splitting 방지)
    - **Key Validation**: Header Key에 공백이나 제어 문자 등 HTTP 토큰으로 유효하지 않은 문자가 포함된 경우, **예외**를 발생시켜야 합니다.
    - **처리 규칙**: 라이브러리 내부에서 헤더를 병합하거나 덮어쓸 때, 키(Key)의 **대소문자를 구분하지 않고(Case-insensitive)** 처리해야 합니다. (예: 사용자가 `content-type`을 보내면, 라이브러리가 `Content-Type`을 중복해서 추가하지 않아야 함)
    - **Browser Limitation**: 브라우저 환경에서는 보안 정책상 `Host`, `User-Agent`, `Content-Length` 등 특정 헤더(Forbidden Header Name) 설정이 무시될 수 있습니다.
    - **Encoding**: 헤더 값은 **ASCII/ISO-8859-1** 범위 내의 문자여야 합니다. 비-ASCII 문자(예: UTF-8 한글)가 포함된 경우 플랫폼에 따라 인코딩 깨짐이나 예외가 발생할 수 있으므로, 사용자가 직접 인코딩(예: RFC 5987)해서 전달해야 합니다.
    - **Precedence**: 사용자가 명시적으로 설정한 헤더는 라이브러리가 자동으로 생성하는 기본 헤더보다 항상 우선합니다. 특히, 헤더 값을 `null`로 설정하면 해당 헤더는 전송되지 않습니다.
- **timeout**: (Optional) 응답 수신 대기 시간 (Number, ms 단위, 기본값: 30000). **(시간 초과 시 `'ETIMEDOUT'` 예외 발생, 0 설정 시 무제한)**
    - **의미**: 소켓 연결 후, 서버로부터 첫 바이트(TTFB)를 포함한 응답 데이터가 수신되기 시작하는 것을 기다리는 시간 (Idle Timeout)입니다. 이는 모든 플랫폼에서 가장 일관되게 구현 가능한 시간 제한입니다.
    - **Redirect**: 리다이렉트 발생 시, 새로운 요청에 대해 타이머가 초기화됩니다.
- **totalTimeout**: (Optional) 요청의 전체 수명 주기 제한 시간 (Number, ms 단위, 기본값: 0).
    - **의미**: DNS 조회, 연결, 요청 전송, 재시도, 리다이렉트를 포함한 모든 과정이 이 시간 내에 완료되어야 함을 의미합니다. 라이브러리는 이 시간 제한을 반드시 준수해야 합니다.
    - `0`은 무제한을 의미합니다.
- **saveRawBody**: (Optional) `true` 설정 시, 파싱된 `body` 외에 원본 텍스트/버퍼를 `rawBody` 필드로 응답 객체에 포함합니다. (HMAC 검증 등에 사용)
    - `responseType`이 `'stream'`인 경우, 이 옵션은 **무시(Ignored)**됩니다. (스트림은 버퍼링되지 않음)
- **requestId**: (Optional) 요청 식별자 (String). (설정하지 않으면 UUID 등을 자동 생성하여 할당 권장)
- **auth**: (Optional) 인증 정보 객체.
    - Basic Auth: `{ username: 'user', password: 'pw' }` (RFC 7617에 따라 **UTF-8**로 인코딩합니다.)
    - Bearer Token: `{ bearer: 'token_string' }` (헤더에 `Authorization: Bearer ...` 자동 추가)
    - 주의: `headers`에 `Authorization` 값이 이미 존재하면, 이 옵션은 **무시**됩니다.
    - **Ambiguity**: Basic, Bearer 등 여러 인증 타입을 동시에 지정하면 **예외**를 발생시켜야 합니다.
- **withCredentials**: (Optional) `cookieMode: 'browser'`일 때, Cross-Origin 요청에 쿠키/인증 헤더를 포함할지 여부 (Boolean, 기본값: `false`). (Fetch API의 `credentials: 'include'`에 대응)
- **redirect**: (Optional) 리다이렉션 처리 방식 (String, 기본값: `'follow'`).
    - `'follow'`: 3xx 응답을 자동으로 따라갑니다. (최대 10회)
    - **Method Change**: `301`, `302`, `303` 응답 시, 리다이렉트 요청의 메서드는 **`GET`**으로 변경되며 요청 Body는 제거됩니다. (`307`, `308`은 메서드와 Body 유지)
    - `'error'`: 3xx 응답을 네트워크 오류로 처리합니다.
    - `'manual'`: 3xx 응답을 그대로 반환합니다. (상태 코드 확인 필요)
        - **Note**: 이 경우 3xx 상태 코드가 반환되므로, `validateStatus` 설정에 따라 에러로 처리될 수 있습니다. 필요시 `validateStatus`를 조정하십시오.
    - **보안 (서버 환경 요구사항)**: 서버 환경 구현체는 Cross-Domain 리다이렉트 시 `Authorization`, `Cookie`, `Proxy-Authorization` 헤더를 자동으로 **제거(Strip)**해야 합니다. 브라우저에서는 이 동작을 제어할 수 없습니다.
- **maxRedirects**: (Optional) 리다이렉트 최대 허용 횟수 (Number, 기본값: 10). (`redirect: 'follow'`일 때만 적용. 브라우저 환경에서는 보안 정책에 따라 무시되거나 제한될 수 있음)
- **retry**: (Optional) 실패 시 재시도 횟수 (Number, 기본값: 0).
    - 네트워크 오류, 5xx 서버 오류, **429(Too Many Requests)** 응답 시 재시도합니다.
    - **Precedence**: 재시도 로직은 `validateStatus`보다 **먼저** 동작합니다. (예: 500 에러 발생 시, `validateStatus`가 성공으로 설정되어 있어도 재시도 정책에 따라 재시도를 우선 수행합니다. 재시도가 모두 실패하면 그때 `validateStatus`를 적용합니다.)
    - **Retry-After**: 429 또는 503 응답에 `Retry-After` 헤더가 포함된 경우, `retryDelay` 설정보다 우선하여 해당 시간만큼 대기 후 재시도해야 합니다. (초 단위, HTTP-Date 형식 모두 지원해야 함)
    - **Timeout 충돌**: `Retry-After` 대기 시간이 남은 `totalTimeout`을 초과할 경우, 재시도하지 않고 즉시 **`'ETIMEDOUT'`** 예외를 발생시켜야 합니다.
    - **Stream Limitation**: `responseType: 'stream'`인 경우, 재시도 로직은 **응답 헤더가 수신되기 전(Promise Resolve 전)**까지만 동작합니다. 스트림 데이터를 읽는 도중(Promise Resolve 후)에 발생하는 네트워크 에러는 자동 재시도되지 않습니다.
- **retryCondition**: (Optional) 재시도 여부를 결정하는 커스텀 함수. `(error, retryCount) => boolean | Promise<boolean>`
    - 이 함수가 설정되면, **기본 재시도 조건(네트워크 오류, 5xx, 429)은 무시되고** 이 함수의 반환값에 따라서만 재시도가 결정됩니다. 이를 통해 `401` 응답 후 토큰 갱신 재시도 등 완전히 커스텀된 로직을 구현할 수 있습니다.
- **retryDelay**: (Optional) 재시도 간 대기 시간 (Number | Function, ms 단위, 기본값: 0).
    - **Number**: 고정 대기 시간.
    - **Function**: `(retryCount, error) => number` (지수 백오프 등 동적 계산 가능. `retryCount`는 1부터 시작하는 정수입니다.)
- **adapter**: (Optional) 실제 네트워크 요청을 수행하는 커스텀 어댑터 함수. `(config) => Promise<Response>`
    - Mocking, 테스팅, 혹은 특수한 프로토콜 처리를 위해 내부 로직을 대체할 때 사용합니다. 어댑터는 **단일 요청 시도**에 대한 책임만 가지며, 재시도나 리다이렉트 로직은 `jady.call`의 핵심 로직이 어댑터를 여러 번 호출하는 방식으로 처리합니다.
- **responseType**: (Optional) 응답 데이터의 타입 지정 (String, 기본값: `'auto'`).
    - `'auto'`: 아래의 **결정론적 규칙**에 따라 JSON, Text, Binary 자동 처리.
        - 1. `Content-Type` 헤더가 `application/json`이거나 `+json` 접미사(예: `application/problem+json`)를 포함하면 **JSON**으로 처리합니다.
        - 2. 위 조건에 해당하지 않고, `Content-Type`이 `text/`로 시작하거나 `application/xml`, `application/javascript` 등 명백한 텍스트 타입이면 **Text**로 처리합니다.
        - 3. 그 외의 모든 경우는 **Binary**로 처리.
    - `'json'`: 강제로 JSON 파싱 시도. (파싱 실패 시 `'EPARSE'` 예외 발생)
    - `'text'`: 강제로 텍스트로 반환.
    - `'bytes'`: Binary Data (Buffer/Bytes)로 반환.
    - `'arraybuffer'`: `'bytes'`와 동일 (Browser 호환성).
    - `'stream'`: 스트림(Stream) 객체로 반환. (대용량 파일 처리 시 필수)
    - `'blob'`: **Blob** 객체로 반환. (브라우저 환경 등 Blob API 지원 시)
    - `'document'`: **HTML Document** 객체로 반환. (브라우저 환경 등 DOM Parser 지원 시. 지원하지 않는 환경에서는 **예외**를 발생시켜야 함)
- **responseEncoding**: (Optional) 응답 텍스트 디코딩 시 사용할 인코딩 (String, 기본값: `'utf-8'`).
    - `responseType`이 `'text'`, `'json'`이거나 `'auto'`(텍스트로 판별됨)일 때 적용됩니다.
    - **Precedence**: 이 옵션은 `Content-Type` 헤더에 명시된 `charset`보다 우선합니다.
    - `responseType`이 `'stream'`, `'bytes'`, `'arraybuffer'`, `'blob'`인 경우, 이 설정은 **무시(Ignored)**됩니다. (항상 원본 바이너리 반환)
    - 예: `'euc-kr'`, `'windows-1252'`
- **jsonReplacer**: (Optional) JSON 직렬화 시 사용할 변환 함수 또는 화이트리스트 배열. (JS: `JSON.stringify`의 replacer, Python: `default` 함수 등 매핑)
    - **Note**: 함수 시그니처나 타입은 각 언어의 표준 JSON 라이브러리 사양을 따릅니다.
- **jsonReviver**: (Optional) JSON 파싱 시 사용할 변환 함수. (JS: `JSON.parse`의 reviver, Python: `object_hook` 등 매핑)
    - **Note**: 함수 시그니처나 타입은 각 언어의 표준 JSON 라이브러리 사양을 따릅니다.
- **decompress**: (Optional) 응답 본문 자동 압축 해제 여부 (Boolean, 기본값: `true`).
    - `false`로 설정 시, 압축된 바이너리 데이터가 그대로 `body`에 반환됩니다. (다운로드 등에 사용)
    - `true` 설정 시(기본값), `Accept-Encoding: gzip, deflate, br` 헤더가 자동으로 포함됩니다.
- **xsrfCookieName**: (Optional) CSRF 토큰을 읽어올 쿠키 이름 (String, 기본값: `'XSRF-TOKEN'`). (브라우저 환경 전용)
    - **GET, HEAD, OPTIONS, TRACE** 등 읽기 전용 메서드에는 적용되지 않습니다.
- **xsrfHeaderName**: (Optional) CSRF 토큰을 담을 헤더 이름 (String, 기본값: `'X-XSRF-TOKEN'`). (브라우저 환경 전용)
- **validateStatus**: (Optional) 성공(`ok: true`)으로 간주할 상태 코드 범위 지정 함수.
    - 기본값: `(status) => status >= 200 && status < 300`
    - **Note**: 이 기본값에 따르면 `304 Not Modified`는 `ok: false`로 처리됩니다. 캐시 검증 시에는 `validateStatus`를 `(status) => (status >= 200 && status < 300) || status === 304` 와 같이 커스터마이징해야 할 수 있습니다.
- **cache**: (Optional) 캐시 정책 (String, 기본값: `'default'`).
    - `'default'`, `'no-store'`, `'reload'`, `'no-cache'`, `'force-cache'`, `'only-if-cached'` (Fetch API 표준 준수)
- **priority**: (Optional) 요청의 우선순위 (String, 기본값: `'auto'`). (Fetch API 표준 준수)
    - `'high'`, `'low'`, `'auto'`
- **integrity**: (Optional) 리소스 무결성 검증을 위한 해시값 (String). (예: `sha384-...`) (Fetch API 표준 준수)
- **signal**: (Optional) 요청 취소를 위한 시그널 객체. (JS: `AbortSignal`, Python/Java: Cancellation Token/Context 등 언어별 표준 취소 메커니즘 매핑)
    - 요청 시작 시점 혹은 **재시도 대기(Retry Delay) 중**에 시그널이 취소되면, 즉시 대기를 중단하고 **`'ECANCELED'` 예외**를 발생시켜야 합니다.
- **onUploadProgress**: (Optional) 업로드 진행률 콜백 함수. `(progressEvent) => void`
    - `progressEvent`: `{ loaded: number, total?: number }` (브라우저 환경의 경우 XHR을 사용하거나, Fetch 스트림 지원이 필요할 수 있음)
    - **Node.js**: Stream 입력의 경우, 전체 크기(`Content-Length`)를 알 수 없으면 `total` 속성이 생략될 수 있습니다.
    - **Multipart**: Stream이나 File이 포함된 `multipart/form-data` 전송 시, 전체 크기 계산이 어렵거나 비용이 많이 드는 경우 `total` 속성이 생략(`undefined`)될 수 있습니다.
    - **Async Handling**: 이 콜백은 비동기로 호출될 수 있지만, 라이브러리는 콜백의 완료를 기다리지 않습니다(Fire-and-forget).
    - **Redirect**: 리다이렉트 발생 시, 진행률은 초기화되며 새로운 요청에 대해 0부터 다시 시작합니다.
- **onDownloadProgress**: (Optional) 다운로드 진행률 콜백 함수. `(progressEvent) => void`
    - `progressEvent`: `{ loaded: number, total?: number }` (브라우저 환경의 경우 XHR을 사용하거나, Fetch 스트림 지원이 필요할 수 있음)
    - **Chunked Encoding**: 서버가 `Content-Length`를 보내지 않는 경우(Chunked), `total` 속성은 생략되거나 `0`일 수 있습니다.
    - **Stream Response**: `responseType: 'stream'`일 때도 플랫폼이 지원하는 경우 데이터 수신에 따라 이 콜백이 호출되어야 합니다.
    - **Async Handling**: 이 콜백은 비동기로 호출될 수 있지만, 라이브러리는 콜백의 완료를 기다리지 않습니다(Fire-and-forget).
    - **Wire Bytes**: `loaded`와 `total`은 **압축된(Compressed) 전송 데이터** 기준입니다. (자동 압축 해제된 `body`의 크기와 다를 수 있음)
    - **Redirect**: 리다이렉트 발생 시, 진행률은 초기화되며 새로운 응답에 대해 0부터 다시 시작합니다.
- **meta**: (Optional) 사용자 정의 메타데이터 (Object/Dict).
    - 서버로 전송되지 않으며, 응답 객체나 에러 객체에 그대로 전달되어 로깅이나 후처리에 사용됩니다.
- **hooks**: (Optional) 요청 라이프사이클 훅 (Object).
    - `beforeRequest`: `(config) => config | Promise<config>` (최초 요청 전송 전에 **1회** 실행됩니다.)
    - `afterResponse`: `(response) => response | Promise<response>` (최종 응답 수신 후, `validateStatus` 체크 **이전**에 실행됩니다. 응답 데이터를 정규화하거나 변형할 때 사용합니다.)
    - `beforeError`: `(error) => error | Promise<error>` (최종적으로 던져질(throw) 에러 객체를 대상으로 실행됩니다. 재시도되는 중간 에러에는 실행되지 않습니다.)
    - `beforeRetry`: `(error, retryCount) => void | boolean | Config | Promise<...>` (재시도 직전 실행)
        - `false` 반환: 재시도 중단.
        - `Config` 객체 반환: 이 새로운 `Config`는 다음 재시도 시도에 사용됩니다. (프록시 교체, 딜레이 변경 등)
        - **주의**: `Config`를 반환해도 `retryCount`는 계속 증가하며, 허용된 총 재시도 횟수는 **원래 `Config`**의 `retry` 설정에 의해 제어됩니다.
    - `beforeRedirect`: `(nextConfig, response) => void | Promise<void>` (리다이렉트 직전 실행)
        - `nextConfig`: 리다이렉트될 다음 요청에 사용될 설정 객체입니다. 이 객체를 수정하여 헤더를 추가하거나 URL을 변경하는 등의 작업을 수행할 수 있습니다.
        - `response`: 리다이렉트를 유발한 원본 응답 객체입니다.
- **platform**: (Optional) 플랫폼별 특화 기능 및 저수준 제어 옵션 객체. 이 객체에 포함된 옵션들은 모든 플랫폼에서 동일한 동작을 보장하지 않습니다.
    - **`cookies`**: `cookieMode: 'manual'`일 때, 요청과 함께 전송할 쿠키 객체 (Object/Dict).
        - **Serialization**: 객체는 `key=value` 쌍을 `; `로 이어 붙인 단일 문자열로 직렬화되어야 합니다.
        - **Note**: 값은 별도의 인코딩 없이 그대로 사용됩니다. (필요 시 사용자가 미리 인코딩해야 함)
    - **`timeout`**: 세부 타임아웃 설정 객체.
        - `connect`: 소켓 연결 대기 시간 (Number, ms).
        - `write`: 데이터 전송(Upload) 대기 시간 (Number, ms).
    - **`proxy`**: 프록시 서버 설정 (String | Object | `false`).
        - **String**: `http://user:pass@proxy.com:8080`
        - **Object**: `{ host: string, port: number, protocol?: string, auth?: { username, password }, headers?: Object, noProxy?: string[] }`
            - `auth` 필드가 `host` 문자열의 인증 정보보다 우선합니다.
        - `false` 설정 시 시스템 프록시를 무시하고 직접 연결합니다.
    - **`ssl`**: SSL/TLS 설정 객체. (`ca`, `cert`, `key` 등)
    - **`agent`**: HTTP 연결 풀링을 위한 플랫폼별 에이전트 객체.
    - **`http2`**: HTTP/2 사용 여부 (Boolean).
        - `true` 설정 시 ALPN을 통해 연결을 시도하며, 미지원 시 **HTTP/1.1로 폴백**하는 것을 권장합니다.
    - **`keepAlive`**: HTTP Keep-Alive 활성화 여부 (Boolean).
    - **`maxHeaderSize`**: 응답 헤더의 최대 크기 제한 (Number, bytes). (`0` 설정 시 무제한)
    - **`maxContentLength`**: 요청 본문의 최대 크기 제한 (Number, bytes). (`0` 설정 시 무제한)
    - **`maxBodyLength`**: 응답 본문의 최대 크기 제한 (Number, bytes). (`0` 설정 시 무제한)
    - **`blockPrivateIP`**: 사설 IP 대역 요청 차단 여부 (Boolean).
    - **`socketPath`**: Unix Domain Socket 경로 (String).
    - **`localAddress`**: 로컬 네트워크 인터페이스 IP 주소 (String).
    - **`family`**: DNS 조회 시 사용할 IP 버전 (Number: `4`, `6`, `0`).
    - **`lookup`**: 커스텀 DNS 조회 함수/인터페이스.
    - **`preserveHeaderCase`**: 헤더 키 대소문자 유지 여부 (Boolean).
    - **`referrer`**: Referer 헤더 값 (String).
    - **`referrerPolicy`**: Referrer 정책 (String).
    - **`trace`**: 상세 디버깅 이벤트 콜백 함수. (예: `lookup`, `connect`, `secureConnect`, `upload`, `download` 등)
    - **`native`**: 각 언어/런타임의 고유 옵션을 담는 객체.

## 2. 표준 응답 구조 (The Output)

반환값 역시 언어에 상관없이 동일한 객체 구조를 가져야 합니다.

- **status**: HTTP 상태 코드 (Number)
- **statusText**: HTTP 상태 메시지 (String). (예: "OK", "Not Found")
- **duration**: **마지막 시도**의 요청 시작부터 응답 완료까지 걸린 순수 시간 (Number, ms 단위).
- **totalDuration**: **최초 요청** 시작부터 최종 응답 완료까지 걸린 총 시간 (Number, ms 단위). (재시도, 리다이렉트 시간 포함)
- **timings**: (Optional) 구간별 소요 시간 정보 (Object, ms 단위). (지원하는 플랫폼에 한함)
    - `dns`: DNS 조회 시간.
    - `connect`: TCP 연결 시간 (SSL 핸드셰이크 포함).
    - `send`: 요청 전송 시간.
    - `wait`: 서버 응답 대기 시간 (TTFB).
    - `receive`: 데이터 수신 시간.
- **url**: 최종 응답 URL (String). (리다이렉트가 발생한 경우 리다이렉트 된 최종 주소)
- **attempts**: (Array<Object>) 리다이렉트와 재시도를 포함한 모든 시도 기록.
    - 각 요소는 해당 시점의 응답 또는 에러 정보를 담은 스냅샷 객체입니다. 최소한 다음 필드를 포함해야 합니다: `{ url: string, duration: number, status?: number, statusText?: string, headers?: object, error?: { code: string, message: string } }`
- **request**: (Optional) 네이티브 요청 객체 (Object). (Node.js `ClientRequest`, Browser `XMLHttpRequest` 등)
- **config**: 요청 시 사용된 설정 객체 (Object). (`meta` 포함)
- **body**: 실제 응답 데이터.
    - `responseType` 설정이 최우선으로 적용됩니다.
    - **rawBody**: (Optional) `saveRawBody: true`일 때 포함되는 원본 데이터 (String | Buffer).
    - **HEAD 요청**: `body`는 항상 **`null`**입니다.
    - **자동 압축 해제(Decompression)**: `decompress: true`(기본값)일 경우, Gzip, Deflate, Brotli 등으로 압축된 응답은 자동으로 해제된 후 처리됩니다.
    - JSON 응답 (`application/json`): **Object/Dict**로 자동 파싱. **(BOM(Byte Order Mark) 제거 후 파싱, 실패 시 `'EPARSE'` 예외 발생)**. 디코딩 시에는 `responseEncoding` > `Content-Type`의 `charset` > `UTF-8` 순서의 우선순위를 따릅니다.
    - 텍스트 응답 (`text/*`): **String**. 디코딩 시에는 `responseEncoding` > `Content-Type`의 `charset` > `UTF-8` 순서의 우선순위를 따릅니다.
    - 상태 코드 204 (No Content): **null**.
    - Stream 응답 (`responseType: 'stream'`): 언어별 **Readable Stream** 객체. (사용자가 스트림을 **닫을(Close/Destroy) 책임**이 있습니다)
    - Blob 응답 (`responseType: 'blob'`): **Blob** 객체. (브라우저 환경 등 Blob API 지원 시)
    - 그 외 (이미지, 바이너리 등): **Byte Array / Buffer**.
- **headers**: 응답 헤더 (Object). **모든 Key는 소문자(lowercase)로 정규화**됩니다.
    - 기본값: **String** (여러 값인 경우 `, `로 결합).
    - 예외: **`set-cookie`**는 **String[] (배열)** 형태로 반환해야 합니다. (쿠키 파싱 및 세션 관리를 위함. 단, 브라우저 환경에서는 보안상 접근 불가할 수 있음)
        - **Note**: 브라우저 환경에서는 보안 정책상 `Set-Cookie` 헤더에 접근할 수 없으므로, 이 필드는 **서버 환경에서만 유효**합니다.
- **ok**: 성공 여부 (Boolean, 200~299 사이면 true)

## 3. 에러 처리 (Error Handling)

- **네트워크 오류**: DNS 조회 실패, 연결 거부 등 아예 응답을 받지 못한 경우는 **예외(Exception)**를 발생시켜야 합니다.
- **HTTP 오류**: 4xx, 5xx 응답은 예외가 아니라 정상 응답으로 간주하며, `ok: false`와 해당 `status`를 반환합니다.
- **표준 에러 코드 (Standard Error Codes)**: 발생한 예외 객체는 가능한 한 다음 `code` 속성을 포함해야 합니다.
    - `'ETIMEDOUT'`: 요청 타임아웃.
    - `'ECANCELED'`: 요청 취소 (Signal).
    - `'ENETWORK'`: 네트워크 연결 실패.
    - `'EPARSE'`: 응답 데이터 파싱 실패.
    - `'EMAXREDIRECTS'`: 리다이렉트 횟수 초과.
- **에러 객체 구조 (Error Object Structure)**:
    - `code`: 표준 에러 코드 (String).
    - `message`: 에러 메시지 (String).
    - `response`: (Optional) 응답 객체. (응답을 받았으나 에러인 경우, 또는 파싱 에러 시 포함)
        - `status`, `headers`, `body` (Raw Data) 등을 포함해야 합니다.
    - `timings`: (Optional) 에러 발생 전까지 측정된 구간별 소요 시간 정보. (디버깅에 유용)
    - `config`: 요청 설정 객체.

## 4. 타입 지원 (Type Support - 권장사항)

- **Generics**: TypeScript, Java, Go 등 정적 타입 언어에서는 `body`의 타입을 추론할 수 있도록 제네릭(Generics) 인터페이스를 제공하는 것을 권장합니다.
  - 예: `jady.call<MyResponse>(...)`

## 5. 데이터 처리 규칙 (Data Handling Rules)

- **Query Parameters (`params`)**:
    - `null`, `undefined`: **제외(Omit)**합니다.
    - **빈 배열(`[]`)**: **제외(Omit)**합니다.
    - **빈 문자열(`""`)**: `key=` 형태로 전송합니다.
    - **배열 내부**의 `null`, `undefined` 값도 **제외**합니다. 이때 인덱스는 밀려서 채워집니다(Compact). (예: `paramsArrayFormat: 'index'`일 때 `[1, null, 2]` -> `key[0]=1&key[1]=2`)
    - **Date 객체**: **ISO 8601** 문자열(`YYYY-MM-DDTHH:mm:ss.sssZ`)로 변환합니다. (이후 전체 쿼리 스트링은 표준 `x-www-form-urlencoded` 규칙에 따라 인코딩됩니다.)
    - **Number**: 문자열로 변환합니다. (예: `123` -> `"123"`)
    - `true`, `false`: 문자열 `"true"`, `"false"`로 변환합니다.
- **JSON Body (`data`)**:
    - `undefined`: **제외(Omit)**합니다.
    - `null`: **`null` 값 그대로 전송**합니다. (DB 필드 초기화 등의 목적)
    - **NaN, Infinity**: **`null`**로 변환합니다. (JSON 표준 준수)
    - **Circular Reference**: 순환 참조가 포함된 객체는 직렬화 시 **예외**를 발생시켜야 합니다.
    - **Large Integer (JS)**: JavaScript 환경에서 64-bit 정수(BigInt)는 `JSON.parse` 시 정밀도 손실이 발생할 수 있습니다. 이 경우 `responseType: 'text'` 사용을 권장합니다.
    - **Empty Response**: `responseType: 'json'`일 때 응답 본문이 비어있으면(Length 0), **`null`**을 반환합니다. (파싱 에러 방지)
- **Headers (`headers`)**:
    - `undefined`: **제외(Omit)**합니다. (기본 헤더가 있다면 적용됨)
    - `null`: **제거(Remove)**합니다. (기본 헤더가 있어도 전송하지 않음)
    - **배열(Array)** 값: 쉼표(`,`)로 이어 붙여 하나의 문자열로 만듭니다. (예: `['a', 'b']` -> `"a,b"`). **단, `Cookie` 헤더는 세미콜론(`; `)으로 연결합니다.**
    - **Boolean 값**: 소문자 문자열 `"true"`, `"false"`로 변환합니다. (언어별 `True`/`true` 차이 제거)
    - **Date 객체**: **HTTP Date** 형식(UTC String)으로 변환합니다. (예: `Wed, 21 Oct 2015 07:28:00 GMT`)
    - 그 외의 값: **문자열(String)**로 변환하여 전송합니다.
    - **Key 매칭**: 내부 로직에서 헤더를 확인할 때(예: `Content-Type`), **대소문자를 구분하지 않고(Case-insensitive)** 처리해야 합니다.

- **Multipart Body (`data` + `files`)**:
    - `files`가 존재하여 `multipart/form-data`로 전송되는 경우, `data` 필드의 처리 규칙:
        - **제약 사항**: `data`는 반드시 **Plain Object**여야 합니다. 다른 타입이 전달될 경우 **예외**를 발생시켜야 합니다.
        - **Key Collision**: `data`와 `files`에 동일한 키가 존재할 경우, 덮어쓰지 않고 **두 값 모두 전송(Multi-value)**됩니다.
            - **Warning**: 이 경우 일부 서버 프레임워크는 파싱 에러를 일으키거나 하나의 값만 인식할 수 있습니다.
        - `null`, `undefined`: **제외(Omit)**합니다.
        - **배열(Array)**: `paramsArrayFormat` 설정에 따라 직렬화합니다. (기본값: 동일 Key 반복)
        - **Date 객체**: **ISO 8601** 문자열로 변환하여 전송합니다.
        - **Boolean 값**: 소문자 문자열 `"true"`, `"false"`로 변환하여 전송합니다.
        - **객체(Object)**: JSON 문자열로 변환하여 전송합니다.
        - 그 외: 문자열로 변환하여 전송합니다.